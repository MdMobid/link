<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Redirecting...</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
    </style>
</head>
<body>
    <p id="message">Fetching redirect link, please wait...</p>

    <script>
        const firebaseBaseUrl = 'https://my-vars1-default-rtdb.firebaseio.com/';
        const messageElement = document.getElementById('message');

        // Get the current path (e.g., /tunnel/link1)
        const path = window.location.pathname.split('/').pop();

        // Construct the Firebase URL based on the path
        const firebaseLinkUrl = `${firebaseBaseUrl}${path}.json`;

        fetch(firebaseLinkUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.statusText} (status: ${response.status})`);
                }
                return response.json();
            })
            .then(targetUrl => {
                if (typeof targetUrl === 'string' && targetUrl.trim() !== '') {
                    messageElement.textContent = `Redirecting you to: ${targetUrl}`;
                    window.location.replace(targetUrl);
                } else {
                    throw new Error('Invalid or empty redirect URL received from Firebase.');
                }
            })
            .catch(error => {
                console.error('Redirect failed:', error);
                messageElement.textContent = `Redirect failed. Could not fetch or process the link. Error: ${error.message}`;
            });
    </script>
</body>
</html>
